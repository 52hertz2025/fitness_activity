<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>师恩难忘·2025教师节健身福利</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --gold: #f5c542;
  --gold-light: #ffdd67;
  --gold-dark: #d4a02a;
  --green: #004d40;
  --green-light: #00695c;
  --green-dark: #00251a;
  --glass: rgba(255, 255, 255, 0.1);
  --glass-border: rgba(255, 255, 255, 0.25);
  --glass-hover: rgba(255, 255, 255, 0.2);
  --red: #ff0000;
  --red-light: #ff3333;
  --red-dark: #cc0000;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
}

html, body {
  height: 100%;
  overflow: hidden;
}

body {
  background: linear-gradient(135deg, var(--green) 0%, var(--green-dark) 100%);
  color: #fff;
  position: relative;
}

body::before {
  content: '';
  position: absolute;
  width: 200%;
  height: 200%;
  top: -50%;
  left: -50%;
  background: radial-gradient(circle, var(--gold) 0%, transparent 60%);
  animation: rotate 20s linear infinite;
  opacity: 0.1;
  z-index: -1;
}

@keyframes rotate {
  to { transform: rotate(360deg); }
}

#scroll-container {
  height: 100vh;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  padding: 20px;
  position: relative;
}

.container {
  width: 100%;
  max-width: 850px;
  background: var(--glass);
  backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border);
  border-radius: 28px;
  padding: 40px 30px;
  margin: 0 auto;
  position: relative;
  z-index: 2;
  box-shadow: 0 20px 50px rgba(0, 0, 0, 0.25);
  overflow: hidden;
}

.container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 6px;
  background: linear-gradient(90deg, var(--gold), var(--green-light));
  border-radius: 28px 28px 0 0;
}

.head {
  text-align: center;
  margin-bottom: 30px;
  position: relative;
  padding-bottom: 20px;
}

.head::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 200px;
  height: 4px;
  background: linear-gradient(90deg, transparent, var(--gold), transparent);
  border-radius: 2px;
}

.head h1 {
  font-size: 52px;
  font-weight: 900;
  background: linear-gradient(45deg, #fff 30%, var(--gold-light) 70%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  letter-spacing: 1px;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  margin-bottom: 10px;
  position: relative;
}

.sale-badge {
  position: absolute;
  top: -15px;
  right: 10px;
  background: linear-gradient(45deg, var(--red), #ff6a00);
  color: white;
  font-weight: bold;
  padding: 8px 15px;
  border-radius: 30px;
  font-size: 16px;
  box-shadow: 0 4px 12px rgba(255, 0, 0, 0.4);
  z-index: 10;
  animation: pulse-red 1.5s infinite;
}

@keyframes pulse-red {
  0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); }
  70% { box-shadow: 0 0 0 10px rgba(255, 0, 0, 0); }
  100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); }
}

.head p {
  font-size: 22px;
  color: var(--gold-light);
  margin-top: 8px;
  font-weight: 300;
  letter-spacing: 1px;
}

.countdown-title {
  text-align: center;
  font-size: 26px;
  color: var(--red);
  margin-bottom: 15px;
  font-weight: bold;
  text-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
  animation: flash 1s infinite;
}

@keyframes flash {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

.countdown-box {
  display: flex;
  gap: 20px;
  justify-content: center;
  margin-bottom: 40px;
  flex-wrap: wrap;
  position: relative;
  padding: 25px;
  background: rgba(0, 0, 0, 0.3);
  border-radius: 20px;
  border: 2px solid var(--gold);
  box-shadow: 0 0 20px rgba(245, 197, 66, 0.3);
}

.count-card {
  background: linear-gradient(145deg, var(--red), var(--red-dark));
  border: 2px solid #ffd700;
  box-shadow: 0 6px 20px rgba(255, 0, 0, 0.4);
  border-radius: 16px;
  padding: 20px 12px;
  width: 110px;
  text-align: center;
  transition: all 0.3s ease;
  animation: bounce 2s infinite;
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.count-num {
  font-size: 40px;
  font-weight: 800;
  color: white;
  text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
}

.count-label {
  font-size: 16px;
  font-weight: bold;
  color: white;
  letter-spacing: 1px;
  margin-top: 5px;
}

.price-box {
  display: flex;
  gap: 25px;
  justify-content: center;
  margin-bottom: 40px;
  flex-wrap: wrap;
  position: relative;
}

.limited-badge {
  position: absolute;
  top: -12px;
  left: 50%;
  transform: translateX(-50%);
  background: linear-gradient(45deg, var(--red), #ff6a00);
  color: white;
  font-weight: bold;
  padding: 6px 20px;
  border-radius: 20px;
  font-size: 14px;
  box-shadow: 0 4px 12px rgba(255, 0, 0, 0.4);
  z-index: 10;
  animation: pulse-red 2s infinite;
}

.price-card {
  background: linear-gradient(145deg, rgba(0,77,64,0.4), rgba(0,37,26,0.6));
  border: 1px solid var(--glass-border);
  border-radius: 18px;
  padding: 25px;
  text-align: center;
  flex: 1 1 250px;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

.price-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
}

.price-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 5px;
  background: var(--gold);
}

.price-card del {
  font-size: 20px;
  opacity: 0.7;
  color: rgba(255, 255, 255, 0.8);
}

.price-card strong {
  font-size: 42px;
  color: var(--gold-light);
  display: block;
  margin: 10px 0;
  text-shadow: 0 0 15px rgba(245, 197, 66, 0.4);
}

.price-card small {
  font-size: 14px;
  opacity: 0.9;
  display: block;
  margin-top: 10px;
}

.price-card:nth-child(2) {
  background: linear-gradient(145deg, rgba(197, 156, 51, 0.15), rgba(0,77,64,0.4));
  border: 1px solid var(--gold);
  transform: scale(1.05);
  box-shadow: 0 0 20px rgba(245, 197, 66, 0.5);
}

.price-card:nth-child(2) strong {
  font-size: 32px;
}

.benefit {
  background: rgba(0, 0, 0, 0.25);
  border-left: 4px solid var(--gold);
  padding: 25px;
  border-radius: 12px;
  margin-bottom: 35px;
  position: relative;
  overflow: hidden;
}

.benefit::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: radial-gradient(circle at top right, transparent, rgba(255, 255, 255, 0.05));
  pointer-events: none;
}

.benefit h4 {
  color: var(--gold-light);
  margin-bottom: 15px;
  font-size: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.benefit h4 i {
  font-size: 24px;
}

.benefit p {
  line-height: 1.8;
  margin-bottom: 15px;
  padding-left: 34px;
  opacity: 0.9;
}

.gift {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 35px;
  background: linear-gradient(145deg, rgba(0,77,64,0.4), rgba(0,37,26,0.6));
  border-radius: 18px;
  padding: 20px;
  border: 1px solid var(--glass-border);
  position: relative;
  overflow: hidden;
}

.gift::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(45deg, rgba(255, 0, 0, 0.1), transparent);
  z-index: 0;
}

.gift-badge {
  position: absolute;
  top: -10px;
  right: -30px;
  background: var(--red);
  color: white;
  padding: 20px 40px;
  transform: rotate(45deg);
  font-size: 12px;
  font-weight: bold;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
}

.gift img {
  width: 120px;
  border-radius: 12px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
  animation: float 3s ease-in-out infinite;
  position: relative;
  z-index: 1;
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-15px); }
}

.gift-content {
  flex: 1;
  position: relative;
  z-index: 1;
}

.gift-content div:first-child {
  font-size: 22px;
  color: var(--gold-light);
  font-weight: 700;
  margin-bottom: 8px;
}

.gift-content div:last-child {
  font-size: 16px;
  opacity: 0.9;
  line-height: 1.6;
}

.address {
  text-align: center;
  margin-bottom: 35px;
}

.address button {
  background: linear-gradient(145deg, var(--gold), var(--gold-dark));
  color: var(--green);
  border: none;
  padding: 14px 32px;
  border-radius: 50px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 18px;
  box-shadow: 0 5px 15px rgba(245, 197, 66, 0.3);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin: 0 auto;
}

.address button:hover {
  background: linear-gradient(145deg, var(--gold-light), var(--gold));
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(245, 197, 66, 0.4);
}

.address button:active {
  transform: translateY(1px);
}

.form-section {
  background: rgba(0, 0, 0, 0.3);
  border-radius: 18px;
  padding: 30px;
  border: 1px solid var(--glass-border);
  position: relative;
}

.form-section h3 {
  text-align: center;
  font-size: 28px;
  margin-bottom: 25px;
  color: var(--gold-light);
  position: relative;
  padding-bottom: 15px;
}

.form-section h3::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 150px;
  height: 3px;
  background: linear-gradient(90deg, transparent, var(--gold), transparent);
  border-radius: 3px;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-size: 16px;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 8px;
}

.form-group label.required::after {
  content: '*';
  color: var(--gold);
  margin-left: 4px;
}

.form-group input,
.form-group select {
  width: 100%;
  padding: 14px 18px;
  border: 1px solid var(--glass-border);
  border-radius: 12px;
  background: rgba(0, 0, 0, 0.2);
  color: #fff;
  font-size: 16px;
  transition: all 0.3s ease;
}

.form-group input:focus,
.form-group select:focus {
  outline: none;
  border-color: var(--gold);
  box-shadow: 0 0 0 3px rgba(245, 197, 66, 0.2);
  background: rgba(0, 0, 0, 0.3);
}

.form-group input::placeholder {
  color: rgba(255, 255, 255, 0.5);
}

.upload-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 12px 20px;
  background: linear-gradient(145deg, var(--gold), var(--gold-dark));
  color: var(--green);
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
  margin-top: 10px;
  transition: all 0.3s ease;
}

.upload-btn:hover {
  background: linear-gradient(145deg, var(--gold-light), var(--gold));
  transform: translateY(-2px);
}

.upload-name {
  font-size: 14px;
  margin-top: 10px;
  color: rgba(255, 255, 255, 0.8);
  padding-left: 10px;
}

.qr-container {
  text-align: center;
  margin: 25px 0;
  padding: 25px;
  background: rgba(255, 0, 0, 0.15);
  border-radius: 15px;
  border: 2px dashed var(--gold);
  position: relative;
}

.qr-highlight {
  color: #ff0000;
  font-weight: bold;
  font-size: 22px;
  margin-bottom: 15px;
  text-shadow: 0 0 5px rgba(255, 0, 0, 0.5);
  animation: flash 1.5s infinite;
}

#payQr {
  width: 380px;
  height: 400px;
  display: block;
  margin: 0 auto 15px;
  border-radius: 12px;
  border: 3px solid #ff0000;
  background: white;
  padding: 15px;
  box-shadow: 0 8px 25px rgba(255, 0, 0, 0.3);
  animation: glow 2s infinite alternate;
}

@keyframes glow {
  from { box-shadow: 0 0 10px #ff0000; }
  to { box-shadow: 0 0 20px #ff0000, 0 0 30px #ff0000; }
}

.submit-btn {
  width: 100%;
  padding: 18px;
  background: linear-gradient(145deg, var(--red), var(--red-dark));
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 18px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-top: 10px;
  letter-spacing: 1px;
  box-shadow: 0 5px 15px rgba(255, 0, 0, 0.4);
  position: relative;
  overflow: hidden;
}

.submit-btn:hover {
  background: linear-gradient(145deg, var(--red-light), var(--red));
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(255, 0, 0, 0.5);
}

.submit-btn:active {
  transform: translateY(1px);
}

.submit-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: 0.5s;
}

.submit-btn:hover::before {
  left: 100%;
}

.toast {
  position: fixed;
  top: 30px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.9);
  color: var(--gold-light);
  padding: 16px 32px;
  border-radius: 12px;
  display: none;
  z-index: 999;
  font-weight: bold;
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
  border: 1px solid var(--gold);
  animation: fadeInOut 0.3s ease;
}

@keyframes fadeInOut {
  0% { opacity: 0; transform: translate(-50%, -20px); }
  100% { opacity: 1; transform: translate(-50%, 0); }
}

@media (max-width: 768px) {
  .head h1 { font-size: 42px; }
  .head p { font-size: 18px; }
  .count-card { width: 80px; padding: 15px 10px; }
  .count-num { font-size: 32px; }
  .price-card { flex: 1 1 100%; }
  .gift { flex-direction: column; text-align: center; }
  .gift img { width: 140px; }
  .address button { width: 100%; max-width: 300px; }
  #payQr { width: 200px; height: 200px; }
}

@media (max-width: 480px) {
  #scroll-container { padding: 10px; }
  .container { padding: 25px 15px; }
  .head h1 { font-size: 36px; }
  .count-card { width: 70px; }
  .count-num { font-size: 28px; }
  .benefit { padding: 20px 15px; }
  .benefit p { padding-left: 0; }
  .form-section { padding: 20px 15px; }
  .submit-btn { padding: 16px; font-size: 16px; }
  #payQr { width: 180px; height: 180px; }
}

/* 滚动条样式 */
#scroll-container::-webkit-scrollbar {
  width: 8px;
}

#scroll-container::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.1);
}

#scroll-container::-webkit-scrollbar-thumb {
  background: var(--gold);
  border-radius: 4px;
}

/* 浮动装饰元素 */
.deco {
  position: absolute;
  z-index: 1;
  opacity: 0.1;
}

.deco-1 {
  top: 5%;
  left: 5%;
  width: 60px;
  height: 60px;
  border: 2px solid var(--gold);
  border-radius: 50%;
  animation: pulse 4s infinite alternate;
}

.deco-2 {
  bottom: 10%;
  right: 7%;
  width: 40px;
  height: 40px;
  border: 2px solid var(--gold);
  border-radius: 50%;
  animation: pulse 3s 1s infinite alternate;
}

.deco-3 {
  top: 15%;
  right: 10%;
  width: 30px;
  height: 30px;
  border: 2px solid var(--gold);
  transform: rotate(45deg);
  animation: rotate 20s linear infinite reverse;
}

@keyframes pulse {
  0% { transform: scale(1); opacity: 0.1; }
  100% { transform: scale(1.2); opacity: 0.2; }
}
</style>
</head>
<body>
<!-- 装饰元素 -->
<div class="deco deco-1"></div>
<div class="deco deco-2"></div>
<div class="deco deco-3"></div>

<!-- 滚动容器 -->
<div id="scroll-container">
  <div class="container">
    <div class="head">
      <div class="sale-badge">限时抢购</div>
      <h1>师恩难忘</h1>
      <p>致敬师者·健康同行 | 2025 教师节专属健身福利卡</p>
    </div>

    <!-- 倒计时 -->
    <div class="countdown-box">
      <div class="countdown-title">距离活动结束仅剩</div>
      <div id="countdown"></div>
    </div>

    <!-- 价格卡片 -->
    <div class="price-box">
      <div class="limited-badge">限量抢购</div>
      <div class="price-card">
        <del>原价 1839 元</del>
        <strong>985 元</strong>
        <small>教师节当天仅此一次</small>
      </div>
      <div class="price-card">
        <strong>前 5 名</strong>
        <div>送价值 300 元</div>
        <div>一米二羊驼凳</div>
      </div>
    </div>

    <!-- 福利清单 -->
    <div class="benefit">
      <h4><i class="fas fa-calendar-alt"></i>活动时间</h4>
      <p>2025 年 9 月 10 日（教师节当天）<br>凭教师资格证 / 学校工作证明参与</p>

      <h4><i class="fas fa-gift"></i>当天免费畅练</h4>
      <p>全天免费健身（器械区 + 团课）<br>专业教练现场「教师专属体态评估」1 次</p>

      <h4><i class="fas fa-map-marker-alt"></i>地址 & 电话</h4>
      <p>会宁颐园水景广场商业街 2 楼<br>电话：0943-3256546</p>
    </div>

    <!-- 羊驼凳 -->
    <div class="gift">
      <div class="gift-badge">限量</div>
      <img src="https://img0.baidu.com/it/u=2836893172,415776004&fm=253&app=138&f=JPEG?w=500&h=500" alt="羊驼凳">
      <div class="gift-content">
        <div>限量羊驼凳</div>
        <div>前 5 名到手！软萌治愈，健身也能可可爱爱~</div>
      </div>
    </div>

    <!-- 一键导航 -->
    <div class="address">
      <button onclick="openMap()">
        <i class="fas fa-map-marked-alt"></i>一键导航到店
      </button>
    </div>

    <!-- 报名表单 -->
    <div class="form-section">
      <h3>教师专属报名通道</h3>
      <form id="form">
        <div class="form-group">
          <label class="required"><i class="fas fa-user"></i>姓名</label>
          <input type="text" name="name" placeholder="请输入姓名" required>
        </div>
        <div class="form-group">
          <label class="required"><i class="fas fa-mobile-alt"></i>手机号</label>
          <input type="tel" name="phone" placeholder="11 位手机号" maxlength="11" required>
        </div>
        <div class="form-group">
          <label><i class="fas fa-dumbbell"></i>推荐教练</label>
          <select name="coach">
            <option value="">请选择（可选）</option>
            <option>武教练</option>
            <option>蔺教练</option>
            <option>周教练</option>
            <option>陈教练</option>
            <option>任教练</option>
          </select>
        </div>
        <div class="form-group">
          <label><i class="fas fa-certificate"></i>教师资格证 / 工作证明（可选）</label>
          <input type="file" name="cert" id="cert" accept="image/*">
          <label for="cert" class="upload-btn">
            <i class="fas fa-upload"></i>选择文件
          </label>
          <div id="certName" class="upload-name"></div>
        </div>
        <div class="form-group">
          <label><i class="fas fa-qrcode"></i>支付二维码</label>
          <div class="qr-container">
            <div class="qr-highlight">请扫码支付后上传截图</div>
            <img id="payQr" src="" alt="支付二维码">
          </div>
          <label class="required"><i class="fas fa-file-image"></i>支付截图</label>
          <input type="file" name="payPic" id="payPic" accept="image/*" required>
          <label for="payPic" class="upload-btn">
            <i class="fas fa-upload"></i>选择支付截图
          </label>
          <div id="payName" class="upload-name"></div>
        </div>
        <button type="submit" class="submit-btn">
          <i class="fas fa-lock"></i>立即锁定福利
        </button>
      </form>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* ===== Supabase 初始化 ===== */
const _supabase = supabase.createClient(
  'https://felxoutuqbkwitzcmdvo.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZlbHhvdXR1cWJrd2l0emNtZHZvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcxNDUxNTAsImV4cCI6MjA3MjcyMTE1MH0.SATJ4P-quvK8Y_jPVGipRc8s2GCZBRktV9r_XnzM730'
);

/* ===== 实时拉库 → 动态收款码 + 倒计时 ===== */
(async()=>{
  try {
    const {data,error}=await _supabase.from('activity_config').select('*').single();
    if(error) throw error;

    const supabaseProjectId = 'felxoutuqbkwitzcmdvo'; // 你的项目ID
    const bucketName = 'photo'; // 你的桶名
    const supabasePublicPrefix = `https://${supabaseProjectId}.supabase.co/storage/v1/object/public/${bucketName}/`;
    // 动态设置收款码（正确URL：前缀+文件名+时间戳）
    document.getElementById('payQr').src = `${supabasePublicPrefix}${data.pay_qr}?t=${Date.now()}`;


    // 倒计时到 2025-09-10 23:59:59
    startCount(new Date('2025-09-10T23:59:59'));
  } catch(error) {
    showToast('读取活动失败: ' + error.message);
  }
})();

/* ===== 倒计时 ===== */
function startCount(end){
  updateCount(); // 立即更新一次
  setInterval(updateCount, 1000);

  function updateCount() {
    const d = Math.max(0, end - new Date());
    const days = Math.floor(d / 864e5);
    const hrs = Math.floor(d % 864e5 / 36e5);
    const min = Math.floor(d % 36e5 / 6e4);
    const sec = Math.floor(d % 6e4 / 1e3);

    document.getElementById('countdown').innerHTML = `
      <div class="count-card">
        <div class="count-num">${String(days).padStart(2, '0')}</div>
        <div class="count-label">天</div>
      </div>
      <div class="count-card">
        <div class="count-num">${String(hrs).padStart(2, '0')}</div>
        <div class="count-label">时</div>
      </div>
      <div class="count-card">
        <div class="count-num">${String(min).padStart(2, '0')}</div>
        <div class="count-label">分</div>
      </div>
      <div class="count-card">
        <div class="count-num">${String(sec).padStart(2, '0')}</div>
        <div class="count-label">秒</div>
      </div>
    `;
  }
}

/* ===== 导航 ===== */
function openMap(){
  window.open('https://uri.amap.com/search?keyword=会宁颐园水景宴西楼2楼','_blank');
}

/* ===== 文件回显 ===== */
document.getElementById('cert').onchange = e => {
  document.getElementById('certName').textContent = e.target.files[0]?.name || '';
};

document.getElementById('payPic').onchange = e => {
  document.getElementById('payName').textContent = e.target.files[0]?.name || '';
};

/* ===== 提交表单 ===== */
document.getElementById('form').onsubmit = async e => {
  e.preventDefault();

  const name = document.querySelector('input[name="name"]').value.trim();
  const phone = document.querySelector('input[name="phone"]').value;
  const certFile = document.querySelector('input[name="cert"]').files[0];
  const payFile = document.querySelector('input[name="payPic"]').files[0];

  // 表单验证
  if (!name) return showToast('请输入姓名');
  if (!/^1[3-9]\d{9}$/.test(phone)) return showToast('手机号格式错误');
  // 教师资格证现在是非必填的，所以移除了这个验证
  if (!payFile) return showToast('请上传支付截图');

  showToast('正在提交，请稍候...');

  try {
    // 上传资格证（如果提供了）
    let certPath = null;
    if (certFile) {
      certPath = `cert/${Date.now()}_${certFile.name}`;
      const { error: certError } = await _supabase.storage
        .from('photo')
        .upload(certPath, certFile);

      if (certError) throw new Error('资格证上传失败: ' + certError.message);
    }

    // 上传支付截图
    const payPath = `pay/${Date.now()}_${payFile.name}`;
    const { error: payError } = await _supabase.storage
      .from('photo')
      .upload(payPath, payFile);

    if (payError) throw new Error('支付截图上传失败: ' + payError.message);

    // 表单数据写入数据库
    const coach = document.querySelector('select[name="coach"]').value;
    const { error: dbError } = await _supabase.from('teacher_reg').insert({
      name: name,
      phone: phone,
      coach: coach,
      cert_proof: certPath, // 可能为 null
      pay_proof: payPath
    });

    if (dbError) throw new Error('数据库写入失败: ' + dbError.message);

    showToast('锁定成功！客服将在24h内联系您');

    // 重置表单
    e.target.reset();
    document.getElementById('certName').textContent = '';
    document.getElementById('payName').textContent = '';

  } catch (error) {
    showToast(`提交失败: ${error.message}`);
    console.error(error);
  }
};

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.style.display = 'block';

  setTimeout(() => {
    t.style.display = 'none';
  }, 3000);
}

// 添加简单动画效果
document.addEventListener('DOMContentLoaded', () => {
  const container = document.querySelector('.container');
  container.style.opacity = '0';
  container.style.transform = 'translateY(20px)';

  setTimeout(() => {
    container.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
    container.style.opacity = '1';
    container.style.transform = 'translateY(0)';
  }, 100);

  // 滚动修复：确保滚动容器初始化
  const scrollContainer = document.getElementById('scroll-container');
  scrollContainer.scrollTop = 0;
});
</script>
</body>
</html>
